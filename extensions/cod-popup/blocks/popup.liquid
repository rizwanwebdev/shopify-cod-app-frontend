{% if block.settings.enabled %}
  <button
    id="cod-btn"
    class="cod-button button button-solid"
    style="--text-color: {{ block.settings.text_color }}; --bg-color: {{ block.settings.bg_color }};"
  >
    {{ block.settings.title }}
  </button>

  <!-- COD Popup container (hidden by default, populated with Liquid) -->
  <div id="cod-popup-container" data-product-id="{{ product.id }}">
    <div id="cod-popup" class="cod-popup" >
      <style>
        .cod-popup{
          opacity:0; visibility:hidden;
        }
      </style>
      <div class="cod-popup-content">
        <div class="popup-title">
          <h3>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="currentColor" class="truck-icon" style="width: 40px; height: 30px;">
              <path fill="currentColor" d="M19.5 8H17V6c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v9c0 1.1.9 2 2 2 0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h1c.55 0 1-.45 1-1v-3.33c0-.43-.14-.85-.4-1.2L20.3 8.4c-.19-.25-.49-.4-.8-.4zM6 18c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm13.5-8.5l1.96 2.5H17V9.5h2.5zM18 18c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"></path>
            </svg>
            Cash On Delivery
          </h3>
          <span id="closeCodForm" class="cod-close">&times;</span>
        </div>

        <div class="popup-details">
          <div class="popup-product">
            <img
              src="{{ product.featured_image | image_url: width: 100 }}"
              alt="{{ product.title | escape }}"
              width="100"
              height="100"
            >
            <h4>{{ product.title }}</h4>
          </div>

          <div class="popup-price">
            <p>
              <span class="larger font-semi">Product Price</span>
              <span class="larger font-semi">{{ product.price | money }}</span>
            </p>
            <p>
              <span class="larger font-semi">Shipping</span>
              <span class="larger font-semi">Free</span>
            </p>
            <hr>
            <p>
              <span class="larger font-semi">Total</span>
              <span class="h3 font-semi foreground">{{ product.price | money }}</span>
            </p>
          </div>
        </div>

        <form id="codOrderForm">
          <fieldset>
            <label for="cod-name">Full Name *</label>
            <input autocomplete="name" id="cod-name" type="text" name="name" placeholder="پورا نام" required>
          </fieldset>
          <fieldset>
            <label for="cod-phone">Phone Number *</label>
            <input autocomplete="tel" id="cod-phone" type="tel" name="phone" placeholder="فون نمبر" required>
          </fieldset>
          <fieldset>
            <label for="cod-address">Delivery Address *</label>
            <input autocomplete="street-address" id="cod-address" type="text" name="address" placeholder="ڈیلیوری کا پتہ" required>
          </fieldset>
          <fieldset>
            <label for="cod-city">City *</label>
            <input autocomplete="address-level2" id="cod-city" type="text" name="city" placeholder="آپ کے شہر کا نام" required>
          </fieldset>

          <input type="hidden" name="product_id" value="{{ product.id }}">
          <input type="hidden" name="product_title" value="{{ product.title | escape }}">
          <input type="hidden" name="product_price" value="{{ product.price | money_without_currency }}">
           <!-- Hidden fields required by your backend -->
            <input type="hidden" name="variantId" value="{{ product.selected_or_first_available_variant.id }}">
            <input type="hidden" name="quantity" value="1">

          <button id="submitBtn" type="submit" class="button button-outline">
            Place Order
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Friendly Message Popup -->
<div id="message-popup" class="message-popup">
  <div class="message-box">
    <span id="message-text"></span>
    <button id="message-close">&times;</button>
  </div>
</div>

  <!-- Load JS and CSS assets from the app extension -->
  {{ 'cod-popup.css' | asset_url | stylesheet_tag }}
<script src="{{ 'cod-popup.js' | asset_url }}" defer></script>
{% endif %}

{% schema %}
{
  "name": "COD Popup",
  "target": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "enabled",
      "label": "Enable COD Popup",
      "default": true
    },
    {
      "type": "text",
      "id": "title",
      "label": "Button Text",
      "default": "Buy With Cash On Delievry"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color"
    }
  ]
}
{% endschema %}