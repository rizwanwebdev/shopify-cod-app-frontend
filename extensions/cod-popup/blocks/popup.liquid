{% if block.settings.enabled %}
  <button
    id="cod-btn"
    class="cod-button btn-wobble"
    style="--text-color: {{ block.settings.text_color }}; --bg-color: {{ block.settings.bg_color }};"
  >
    {{ block.settings.title }}
  </button>

  <!-- COD Popup container (hidden by default, populated with Liquid) -->
  <div id="cod-popup-container" data-product-id="{{ product.id }}">
    <div id="cod-popup" class="cod-popup" >
      <style>
        .cod-popup{
          opacity:0; visibility:hidden;
        }
      </style>
      <div class="cod-popup-content">
        <div class="popup-title">
          <h3 class="larger">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="currentColor" class="truck-icon" style="width: 40px; height: 30px;">
              <path fill="currentColor" d="M19.5 8H17V6c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v9c0 1.1.9 2 2 2 0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h1c.55 0 1-.45 1-1v-3.33c0-.43-.14-.85-.4-1.2L20.3 8.4c-.19-.25-.49-.4-.8-.4zM6 18c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm13.5-8.5l1.96 2.5H17V9.5h2.5zM18 18c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"></path>
            </svg>
           Free Cash On Delivery
          </h3>
          <span id="closeCodForm" class="cod-close">&#10006;</span>
        </div>

        <div class="popup-details">
          <div class="popup-product">
            <img
              src="{{ product.featured_image | image_url: width: 60 }}"
              alt="{{ product.title | escape }}"
              width="60"
              height="60"
            >
            <p class="font-semi">{{ product.title }}</p>
          </div>

            <p class="larger">
            {{ product.price | money }}
            </p>
        
        </div>

        <form id="codOrderForm">
          <fieldset class="packs-field">
            <label class="pack-offer">
             <div  class="pack-quantity">
               <input type="radio" value="1" name="pack_quantity" id="pack1" checked>
              <span>Pack 1</span>
             </div>
             <span class="pack-price large">Price here</span>
            </label>
            <label class="pack-offer">
              <div class="pack-quantity">
                <input type="radio" value="2" name="pack_quantity" id="pack2">
              <span>Pack 2</span>
              </div>
              <span class="pack-price">Price Here</span>
            </label>
          </fieldset>
          <fieldset>
            <label for="cod-name">Full Name *</label>
            <div class="input-with-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 16 16" fill="none">
              <path d="M8.00001 3C8.82844 3 9.50001 2.32843 9.50001 1.5C9.50001 0.671573 8.82844 0 8.00001 0C7.17158 0 6.50001 0.671573 6.50001 1.5C6.50001 2.32843 7.17158 3 8.00001 3Z" fill="#000000"/>
              <path d="M12 4V2H14V4C14 5.10457 13.1045 6 12 6H10.5454L10.9897 16H8.98773L8.76557 11H7.23421L7.01193 16H5.00995L5.42014 6.77308L3.29995 9.6L1.69995 8.4L4.99995 4H12Z" fill="#000000"/>
              </svg>
              <input autocomplete="name" id="cod-name" type="text" name="name" placeholder="Ù¾ÙˆØ±Ø§ Ù†Ø§Ù…" required>
            </div>
          </fieldset>
          <fieldset>
            <label for="cod-phone">Phone Number *</label>
            <div class="input-with-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 24 24" fill="#000">
              <g clip-path="url(#clip0_15_529)">
              <rect width="24" height="24" fill="white"/>
              <path d="M2.01394 6.87134C1.34749 10.0618 3.85967 13.8597 7.01471 17.0147C10.1698 20.1698 13.9676 22.682 17.1581 22.0155C19.782 21.4674 21.1215 20.0697 21.8754 18.8788C22.1355 18.4678 22.0042 17.9344 21.6143 17.6436L17.9224 14.8897C17.5243 14.5928 16.9685 14.633 16.6174 14.9842L14.6577 16.9438C14.6577 16.9438 12.7529 16.3246 10.2288 13.8006C7.70482 11.2766 7.08564 9.37175 7.08564 9.37175L9.04529 7.4121C9.39648 7.06091 9.43671 6.5052 9.13975 6.10709L6.38585 2.4151C6.09505 2.02525 5.56163 1.89395 5.15068 2.15407C3.9597 2.90794 2.56203 4.24747 2.01394 6.87134Z" stroke="#000000" stroke-linecap="round" stroke-linejoin="round"/>
              </g>
              <defs>
              <clipPath id="clip0_15_529">
              <rect width="24" height="24" fill="white"/>
              </clipPath>
              </defs>
              </svg>
              <input autocomplete="tel" id="cod-phone" type="tel" name="phone" placeholder="ÙÙˆÙ† Ù†Ù…Ø¨Ø±" required>
            </div>
          </fieldset>
          <fieldset>
            <label for="cod-address">Delivery Address *</label>
            <div class="input-with-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 8.4666669 8.4666669">
                  <defs id="defs2"/>

                  <g id="layer1" transform="translate(0,-288.53332)">

                  <path d="m 15.996094,0.99609375 c -6.0632836,0 -10.9980445,4.93673065 -10.9980471,11.00000025 -3.8e-6,10.668737 10.3789061,18.779297 10.3789061,18.779297 0.364612,0.290384 0.881482,0.290384 1.246094,0 0,0 10.380882,-8.11056 10.380859,-18.779297 C 27.003893,5.9328244 22.059377,0.99609375 15.996094,0.99609375 Z m 0,6.00195315 c 2.749573,0 5.00585,2.2484784 5.005859,4.9980471 C 21.001971,14.7457 18.745685,17 15.996094,17 c -2.749591,0 -4.998064,-2.2543 -4.998047,-5.003906 9e-6,-2.7495687 2.248474,-4.9980471 4.998047,-4.9980471 z" id="path929" style="color:#000000;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:nonzero;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:#000000;solid-opacity:1;vector-effect:none;fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none;stroke-width:1.99999988;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;paint-order:stroke fill markers;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto;enable-background:accumulate" transform="matrix(0.26458333,0,0,0.26458333,0,288.53332)"/>
                  </g>
                  </svg>

              <input autocomplete="street-address" id="cod-address" type="text" name="address" placeholder="ÚˆÛŒÙ„ÛŒÙˆØ±ÛŒ Ú©Ø§ Ù¾ØªÛ" required>
            </div>
            </fieldset>
          <fieldset>
            <label for="cod-city">City *</label>
            <div class="input-with-icon">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000" width="20px" height="20px" viewBox="0 0 50 50"><path d="M12 3.6132812L12 28L9 28L9 23L7 23L7 28L4 28L4 46L21 46L35 46L46 46L46 15L35 15L35 11.279297L32 10.279297L32 4L30 4L30 9.6113281L28 8.9453125L28 4L26 4L26 8.2792969L12 3.6132812 z M 14 6.3886719L33 12.720703L33 44L28 44L28 40.855469C29.715786 40.405591 31 38.850301 31 37C31 34.802706 29.197294 33 27 33C24.802706 33 23 34.802706 23 37C23 38.850301 24.284214 40.405591 26 40.855469L26 44L21 44L21 28L14 28L14 6.3886719 z M 16 12L16 14L22 14L22 12L16 12 z M 16 16L16 18L31 18L31 16L16 16 z M 37 19L42 19L42 22L37 22L37 19 z M 16 20L16 22L24 22L24 20L16 20 z M 26 20L26 22L31 22L31 20L26 20 z M 16 24L16 26L31 26L31 24L16 24 z M 37 24L42 24L42 27L37 27L37 24 z M 23 28L23 30L31 30L31 28L23 28 z M 37 29L42 29L42 32L37 32L37 29 z M 8 32L11 32L11 34L8 34L8 32 z M 14 32L17 32L17 34L14 34L14 32 z M 37 34L42 34L42 37L37 37L37 34 z M 8 36L11 36L11 38L8 38L8 36 z M 14 36L17 36L17 38L14 38L14 36 z M 37 39L42 39L42 42L37 42L37 39 z M 8 40L11 40L11 42L8 42L8 40 z M 14 40L17 40L17 42L14 42L14 40 z"/></svg>
              <input autocomplete="address-level2" id="cod-city" type="text" name="city" placeholder="Ø¢Ù¾ Ú©Û’ Ø´ÛØ± Ú©Ø§ Ù†Ø§Ù…" required>
            </div>
          </fieldset>

          <input type="hidden" name="product_id" value="{{ product.id }}">
          <input type="hidden" name="product_title" value="{{ product.title | escape }}">
          <input type="hidden" name="product_price" value="{{ product.price | money_without_currency }}">
           <!-- Hidden fields required by your backend -->
            <input type="hidden" name="variantId" value="{{ product.selected_or_first_available_variant.id }}">
            <input type="hidden" name="quantity" value="1">

          <button id="submitBtn" type="submit" class="cod-button vibrate">
           ðŸ›’ Place Order
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Friendly Message Popup -->
<div id="message-popup" class="message-popup">
  <div class="message-box">
    <span id="message-text"></span>
    <button id="message-close">&times;</button>
  </div>
</div>

  <!-- Load JS and CSS assets from the app extension -->
  {{ 'cod-popup.css' | asset_url | stylesheet_tag }}
<script src="{{ 'cod-popup.js' | asset_url }}" defer></script>
{% endif %}

{% schema %}
{
  "name": "COD Popup",
  "target": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "enabled",
      "label": "Enable COD Popup",
      "default": true
    },
    {
      "type": "text",
      "id": "title",
      "label": "Button Text",
      "default": "Buy With Cash On Delievry"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color"
    }
  ]
}
{% endschema %}